<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SFX UI</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <!-- {% block head %}{% endblock %} -->

  <style>
            .readme-content {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                line-height: 1.6;
            }
            .readme-content h1, .readme-content h2, .readme-content h3 {
                border-bottom: 1px solid #e1e4e8;
                padding-bottom: 0.3em;
            }
            .readme-content pre {
                background-color: #f6f8fa;
                border-radius: 6px;
                padding: 16px;
                overflow: auto;
            }
            .readme-content code {
                background-color: #f6f8fa;
                padding: 2px 4px;
                border-radius: 3px;
                font-size: 85%;
            }
            .readme-content blockquote {
                border-left: 4px solid #dfe2e5;
                padding: 0 16px;
                color: #6a737d;
            }
            .file-card {
        cursor: pointer;
        transition: all 0.2s ease;
        }

        .file-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.15) !important;
        }

        .folder-card:hover {
        background-color: #f8f9fa;
        }

        .breadcrumb-item a {
        color: #0d6efd;
        }

        .breadcrumb-item a:hover {
        color: #0a58ca;
        }

        /* Mobile optimizations */
        @media (max-width: 768px) {
        .container-fluid {
            padding-left: 0.75rem;
            padding-right: 0.75rem;
        }
        
        .card-body {
            padding: 0.75rem;
        }
        
        .btn-group .btn {
            font-size: 0.8rem;
        }
        
        .table td, .table th {
            padding: 0.5rem;
            font-size: 0.9rem;
        }
        }

        /* List group hover effects */
        .list-group-item-action:hover {
        background-color: #f8f9fa;
        }

        /* Table row hover */
        tbody tr:hover {
        background-color: #f8f9fa;
        }
        </style>
</head>
<body class="bg-light">
    <!-- VUE.JS TEMPLATE SECTION -->
  <div id="app">
    <div class="container-fluid py-2 py-md-4" id="app" v-if="backendRunning">
        <!-- Mobile Header -->
        <!-- <div class="row mb-3">
            <div class="col">
                <h1 class="text-center h4 h-md-3 text-primary mb-0">
                <i class="bi bi-cloud-arrow-up"></i> 
                <span class="d-none d-sm-inline">Simple File Explorer</span>
                <span class="d-sm-none">SFX</span>
                </h1>
                <p class="text-center text-muted small d-none d-md-block">Manage your files and folders</p>
            <div class="d-flex justify-content-between align-items-center">
                
                <button class="btn btn-outline-primary d-lg-none" 
                        type="button" 
                        data-bs-toggle="collapse" 
                        data-bs-target="#mobileMenu">
                <i class="bi bi-list"></i>
                </button>
            </div>
            </div> -->

        <!-- Mobile Collapsible Menu -->
        <div class="collapse d-lg-none mb-3" id="mobileMenu">
            <div class="card">
            <div class="card-body p-3">
                <!-- Mobile Quick Actions -->
                <div class="row g-2 mb-3">
                <div class="col-6">
                    <button class="btn btn-primary btn-sm w-100" 
                            data-bs-toggle="modal" 
                            data-bs-target="#createFolderModal">
                    <i class="bi bi-folder-plus"></i> Folder
                    </button>
                </div>
                <div class="col-6">
                    <button class="btn btn-success btn-sm w-100" 
                            data-bs-toggle="modal" 
                            data-bs-target="#uploadFileModal">
                    <i class="bi bi-cloud-upload"></i> Upload
                    </button>
                </div>
                </div>
                
                <!-- View Toggle for Mobile -->
                <div class="btn-group w-100 mb-2" role="group">
                <button @click="currentView = 'grid'" 
                        :class="['btn', 'btn-sm', currentView === 'grid' ? 'btn-primary' : 'btn-outline-primary']">
                    <i class="bi bi-grid-3x3-gap"></i>
                </button>
                <button @click="currentView = 'list'" 
                        :class="['btn', 'btn-sm', currentView === 'list' ? 'btn-primary' : 'btn-outline-primary']">
                    <i class="bi bi-list-ul"></i>
                </button>
                <button @click="currentView = 'detailed'" 
                        :class="['btn', 'btn-sm', currentView === 'detailed' ? 'btn-primary' : 'btn-outline-primary']">
                    <i class="bi bi-list-task"></i>
                </button>
                </div>
                
                <!-- Mobile Stats -->
                <div class="d-flex justify-content-around text-center">
                <div>
                    <div class="badge bg-info">{{ fileCount }}</div>
                    <small class="d-block text-muted">Files</small>
                </div>
                <div>
                    <div class="badge bg-warning">{{ folderCount }}</div>
                    <small class="d-block text-muted">Folders</small>
                </div>
                </div>
            </div>
            </div>
        </div>

        <!-- Breadcrumb Navigation -->
        <div class="row mb-3">
            <div class="col">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb bg-white rounded shadow-sm p-2 p-md-3 mb-0">
                <li class="breadcrumb-item">
                    <a href="#" @click="navigateToFolder('base')" class="text-decoration-none">
                    <i class="bi bi-house-door"></i> 
                    <span class="d-none d-sm-inline">Home</span>
                    </a>
                </li>
                <li v-for="(segment, index) in breadcrumbs" :key="index" 
                    :class="['breadcrumb-item', index === breadcrumbs.length - 1 ? 'active' : '']">
                    <a v-if="index < breadcrumbs.length - 1" 
                    href="#" 
                    @click="navigateToFolder(getBreadcrumbPath(index))"
                    class="text-decoration-none text-truncate d-inline-block"
                    style="max-width: 150px;">
                    {{ segment }}
                    </a>
                    <span v-else class="text-truncate d-inline-block" style="max-width: 150px;">{{ segment }}</span>
                </li>
                </ol>
            </nav>
            </div>
        </div>

        <div class="row g-3 g-lg-4">
            <!-- Desktop Sidebar: Quick Actions -->
            <div class="col-lg-3 d-none d-lg-block">
            <div class="card shadow-sm h-100">
                <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="bi bi-lightning"></i> Quick Actions</h5>
                </div>
                <div class="card-body">
                <!-- Create Folder Form -->
                <form @submit.prevent="createFolder" class="mb-4">
                    <label class="form-label fw-bold">Create New Folder</label>
                    <div class="input-group">
                    <input v-model="newFolderName" 
                            type="text" 
                            class="form-control" 
                            placeholder="Folder name"
                            :disabled="loading"
                            required>
                    <button type="submit" 
                            class="btn btn-outline-primary"
                            :disabled="loading || !newFolderName.trim()">
                        <i class="bi bi-folder-plus"></i>
                    </button>
                    </div>
                </form>

                <!-- Upload File Form -->
                <form @submit.prevent="uploadFile">
                    <label class="form-label fw-bold">Upload File</label>
                    <div class="mb-3">
                    <input ref="fileInput" 
                            type="file" 
                            class="form-control"
                            :disabled="loading"
                            required>
                    </div>
                    <button type="submit" 
                            class="btn btn-success w-100"
                            :disabled="loading">
                    <i class="bi bi-cloud-upload"></i> Upload File
                    </button>
                </form>

                <!-- View Toggle -->
                <div class="mt-4 pt-4 border-top">
                    <h6 class="text-muted mb-3">View Options</h6>
                    <div class="btn-group w-100 mb-3" role="group">
                    <button @click="currentView = 'grid'" 
                            :class="['btn', 'btn-sm', currentView === 'grid' ? 'btn-primary' : 'btn-outline-primary']"
                            title="Grid View">
                        <i class="bi bi-grid-3x3-gap"></i>
                    </button>
                    <button @click="currentView = 'list'" 
                            :class="['btn', 'btn-sm', currentView === 'list' ? 'btn-primary' : 'btn-outline-primary']"
                            title="List View">
                        <i class="bi bi-list-ul"></i>
                    </button>
                    <button @click="currentView = 'detailed'" 
                            :class="['btn', 'btn-sm', currentView === 'detailed' ? 'btn-primary' : 'btn-outline-primary']"
                            title="Detailed View">
                        <i class="bi bi-list-task"></i>
                    </button>
                    </div>
                </div>

                <!-- Stats -->
                <div class="mt-4 pt-4 border-top">
                    <h6 class="text-muted">Current Folder Stats</h6>
                    <div class="d-flex justify-content-between">
                    <span>Files:</span>
                    <span class="badge bg-info">{{ fileCount }}</span>
                    </div>
                    <div class="d-flex justify-content-between">
                    <span>Folders:</span>
                    <span class="badge bg-warning">{{ folderCount }}</span>
                    </div>
                </div>
                </div>
            </div>
            </div>

            <!-- Main Content: File List -->
            <div class="col-lg-9">
            <div class="card shadow-sm">
                <div class="card-header d-flex justify-content-between align-items-center flex-wrap gap-2">
                <div class="d-flex align-items-center gap-2">
                    <button @click="goBack" 
                            class="btn btn-outline-secondary btn-sm"
                            :disabled="loading">
                    <i class="bi bi-arrow-left"></i>
                    </button>
                    <h5 class="mb-0 d-none d-md-block">
                    <i class="bi bi-folder2-open"></i> 
                    Contents of: <span class="text-primary">{{ currentFolder }}</span>
                    </h5>
                    <h6 class="mb-0 d-md-none">
                    <i class="bi bi-folder2-open"></i> 
                    <span class="text-primary">{{ currentFolder }}</span>
                    </h6>
                </div>
                
                <div class="d-flex gap-2">
                    <!-- Desktop View Toggle -->
                    <div class="btn-group d-none d-lg-flex" role="group">
                    <button @click="currentView = 'grid'" 
                            :class="['btn', 'btn-sm', currentView === 'grid' ? 'btn-primary' : 'btn-outline-primary']"
                            title="Grid View">
                        <i class="bi bi-grid-3x3-gap"></i>
                    </button>
                    <button @click="currentView = 'list'" 
                            :class="['btn', 'btn-sm', currentView === 'list' ? 'btn-primary' : 'btn-outline-primary']"
                            title="List View">
                        <i class="bi bi-list-ul"></i>
                    </button>
                    <button @click="currentView = 'detailed'" 
                            :class="['btn', 'btn-sm', currentView === 'detailed' ? 'btn-primary' : 'btn-outline-primary']"
                            title="Detailed View">
                        <i class="bi bi-list-task"></i>
                    </button>
                    </div>
                    
                    <!-- Refresh files -->
                    <button @click="refreshFiles" 
                            class="btn btn-outline-secondary btn-sm"
                            :disabled="loading">
                    <i class="bi bi-arrow-clockwise"></i> 
                    <span class="d-none d-md-inline">Refresh</span>
                    </button>
                </div>
                </div>
                <div class="card-body p-2 p-md-3">
                <!-- Loading State -->
                <div v-if="loading" class="text-center py-5">
                    <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="mt-2 text-muted">Loading...</p>
                </div>

                <!-- Empty State -->
                <div v-else-if="files.length === 0" class="text-center py-5">
                    <i class="bi bi-folder2 text-muted" style="font-size: 3rem;"></i>
                    <h5 class="text-muted mt-3">This folder is empty</h5>
                    <p class="text-muted">Upload files or create folders to get started.</p>
                </div>

                <!-- Grid View -->
                <div v-else-if="currentView === 'grid'" class="row g-2 g-md-3">
                    <div v-for="item in files" 
                        :key="item.name" 
                        class="col-6 col-sm-4 col-md-3 col-lg-3">
                    <div class="card h-100 border-0 shadow-sm file-card" 
                        :class="{'folder-card': item.type === 'folder'}"
                        @click="handleItemClick(item)">
                        <div class="card-body text-center p-2 p-md-3">
                        <div class="mb-2">
                            <i :class="getItemIcon(item)" 
                            style="font-size: 2rem;"
                            :class="getItemIconColor(item)"></i>
                        </div>
                        <h6 class="card-title text-truncate mb-1 small" :title="item.name">
                            {{ item.name }}
                        </h6>
                        <small class="text-muted text-capitalize">{{ item.type }}</small>
                        </div>
                        <div v-if="item.type === 'file'" class="card-footer bg-transparent border-0 p-1 p-md-2">
                        <div class="btn-group w-100" role="group">
                            <button @click.stop="viewFile(item.name)" 
                                    class="btn btn-outline-primary btn-sm" 
                                    title="View file">
                            <i class="bi bi-eye"></i>
                            </button>
                            <button @click.stop="downloadFile(item.name)" 
                                    class="btn btn-outline-secondary btn-sm" 
                                    title="Download file">
                            <i class="bi bi-download"></i>
                            </button>
                            <button @click.stop="deleteFile(item.name)" 
                                    class="btn btn-outline-danger btn-sm" 
                                    title="Delete file">
                            <i class="bi bi-trash"></i>
                            </button>
                        </div>
                        </div>
                    </div>
                    </div>
                </div>

                <!-- List View -->
                <div v-else-if="currentView === 'list'" class="list-group list-group-flush">
                    <div v-for="item in files" 
                        :key="item.name" 
                        class="list-group-item list-group-item-action d-flex justify-content-between align-items-center py-2 py-md-3"
                        @click="handleItemClick(item)">
                    <div class="d-flex align-items-center">
                        <i :class="getItemIcon(item)" 
                        class="me-2 me-md-3"
                        :class="getItemIconColor(item)"></i>
                        <div>
                        <h6 class="mb-0 text-truncate" style="max-width: 200px;" :title="item.name">
                            {{ item.name }}
                        </h6>
                        <small class="text-muted text-capitalize">{{ item.type }}</small>
                        </div>
                    </div>
                    <div v-if="item.type === 'file'" class="btn-group" role="group">
                        <button @click.stop="viewFile(item.name)" 
                                class="btn btn-outline-primary btn-sm" 
                                title="View file">
                        <i class="bi bi-eye"></i>
                        </button>
                        <button @click.stop="downloadFile(item.name)" 
                                class="btn btn-outline-secondary btn-sm" 
                                title="Download file">
                        <i class="bi bi-download"></i>
                        </button>
                        <button @click.stop="deleteFile(item.name)" 
                                class="btn btn-outline-danger btn-sm" 
                                title="Delete file">
                        <i class="bi bi-trash"></i>
                        </button>
                    </div>
                    </div>
                </div>

                <!-- Detailed View -->
                <div v-else-if="currentView === 'detailed'" class="table-responsive">
                    <table class="table table-hover">
                    <thead>
                        <tr>
                        <th>Name</th>
                        <th class="d-none d-md-table-cell">Type</th>
                        <th class="d-none d-lg-table-cell">Size (MB)</th>
                        <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-for="item in files" 
                            :key="item.name"
                            @click="handleItemClick(item)"
                            style="cursor: pointer;">
                        <td>
                            <div class="d-flex align-items-center">
                            <i :class="getItemIcon(item)" 
                                class="me-2"
                                :class="getItemIconColor(item)"></i>
                            <span class="text-truncate" :title="item.name">{{ item.name }}</span>
                            </div>
                        </td>
                        <td class="d-none d-md-table-cell">
                            <span class="badge" :class="item.type === 'folder' ? 'bg-warning' : 'bg-info'">
                            {{ item.type }}
                            </span>
                        </td>
                        <td class="d-none d-lg-table-cell">
                            <small class="text-muted">
                            {{ item.size || '-' }}
                            </small>
                        </td>
                        <td>
                            <div v-if="item.type === 'file'" class="btn-group" role="group">
                            <button @click.stop="viewFile(item.name)" 
                                    class="btn btn-outline-primary btn-sm" 
                                    title="View file">
                                <i class="bi bi-eye"></i>
                            </button>
                            <button @click.stop="downloadFile(item.name)" 
                                    class="btn btn-outline-secondary btn-sm" 
                                    title="Download file">
                                <i class="bi bi-download"></i>
                            </button>
                            <button @click.stop="deleteFile(item.name)" 
                                    class="btn btn-outline-danger btn-sm" 
                                    title="Delete file">
                                <i class="bi bi-trash"></i>
                            </button>
                            </div>
                        </td>
                        </tr>
                    </tbody>
                    </table>
                </div>

                <!-- README Section -->
                <div v-show="readmeContent" class="mt-4">
                    <div class="card">
                        <div class="card-header bg-light">
                            <h5 class="card-title mb-0">
                                <i class="bi bi-file-text me-2"></i>README.md
                            </h5>
                        </div>
                        <div class="card-body">
                            <div v-html="readmeContent" class="readme-content"></div>
                        </div>
                    </div>
                </div>
                </div>
            </div>
            </div>
        </div>

        <!-- Mobile Modals -->
        <!-- Create Folder Modal -->
        <div class="modal fade" id="createFolderModal" tabindex="-1">
            <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                <h5 class="modal-title">Create New Folder</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <form @submit.prevent="createFolder">
                <div class="modal-body">
                    <input v-model="newFolderName" 
                        type="text" 
                        class="form-control" 
                        placeholder="Folder name"
                        :disabled="loading"
                        required>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" 
                            class="btn btn-primary"
                            :disabled="loading || !newFolderName.trim()"
                            data-bs-dismiss="modal">
                    Create
                    </button>
                </div>
                </form>
            </div>
            </div>
        </div>

        <!-- Upload File Modal -->
        <div class="modal fade" id="uploadFileModal" tabindex="-1">
            <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                <h5 class="modal-title">Upload File</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <form @submit.prevent="uploadFile">
                <div class="modal-body">
                    <input ref="mobileFileInput" 
                        type="file" 
                        class="form-control"
                        :disabled="loading"
                        required>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" 
                            class="btn btn-success"
                            :disabled="loading"
                            data-bs-dismiss="modal">
                    Upload
                    </button>
                </div>
                </form>
            </div>
            </div>
        </div>

        <!-- Toast Notifications -->
        <div class="toast-container position-fixed bottom-0 end-0 p-3">
            <div v-for="(toast, index) in toasts" 
                :key="index"
                class="toast show" 
                :class="'border-' + toast.type">
            <div class="toast-header">
                <i :class="'bi bi-' + (toast.type === 'success' ? 'check-circle-fill text-success' : 'exclamation-triangle-fill text-danger')"></i>
                <strong class="me-auto ms-2">{{ toast.type === 'success' ? 'Success' : 'Error' }}</strong>
                <button type="button" class="btn-close" @click="removeToast(index)"></button>
            </div>
            <div class="toast-body">
                {{ toast.message }}
            </div>
            </div>
        </div>
    </div>
    <div class="container-fluid py-2 py-md-4" id="app" v-else>
        Please wait while application is loading...
    </div>
  </div>

<!-- VUE.JS SCRIPT SECTION -->
<script>
const { createApp } = Vue;

createApp({
  data() {
    return {
      backendRunning: false,
      files: [],
      currentFolder: 'base',
      currentPath: '',
      newFolderName: '',
      loading: false,
      toasts: [],
      readmeContent: null,
      currentView: 'grid' // Default view
    };
  },
  computed: {
    fileCount() {
      return this.files.filter(item => item.type === 'file').length;
    },
    folderCount() {
      return this.files.filter(item => item.type === 'folder').length;
    },
    breadcrumbs() {
      if (this.currentFolder === 'base') return [];
      return this.currentFolder.split('/').filter(segment => segment);
    }
  },
  mounted() {
    this.checkBackendRunning()
    this.loadFolder();
    // Set default view based on screen size
    this.setDefaultView();
    window.addEventListener('resize', this.setDefaultView);
  },
  methods: {
    checkBackendRunning() {
        const interval = setInterval(async () => {
            try {
                const response = await fetch("http://127.0.0.1:9876/health");
                if (response.ok) {
                    this.backendRunning = true;
                    console.log("Running.");
                    clearInterval(interval);
                    this.refreshFiles()
                    return; // stop here once backend is up
                }
            } catch (err) {
                // fetch fails until backend is ready
            }
            console.log("Checking...");
        }, 200);
    },

    setDefaultView() {
      if (window.innerWidth < 768) {
        this.currentView = 'list';
      } else {
        this.currentView = 'grid';
      }
    },

    async loadFolder() {
      this.loading = true;
      try {
        const path = this.currentPath || '';
        const response = await fetch(`http://127.0.0.1:9876/bucket/folder/${path}`);
        if (!response.ok) throw new Error('Failed to fetch files');
        
        const data = await response.json();
        this.files = data.items || [];
        this.readmeContent = data.readme || null;
        this.currentFolder = data.folder || 'base';
      } catch (error) {
        this.showToast('Failed to load files: ' + error.message, 'error');
      } finally {
        this.loading = false;
      }
    },

    refreshFiles() {
      this.loadFolder();
    },

    async createFolder() {
      if (!this.newFolderName.trim()) return;
      
      this.loading = true;
      try {
        const folderPath = this.currentPath 
          ? `${this.currentPath}/${this.newFolderName}` 
          : this.newFolderName;
        
        const response = await fetch(`http://127.0.0.1:9876/bucket/folder/${folderPath}`, {
          method: 'POST'
        });
        
        if (!response.ok) throw new Error('Failed to create folder');
        
        const data = await response.json();
        this.showToast(data.message || 'Folder created successfully', 'success');
        this.newFolderName = '';
        await this.loadFolder();
      } catch (error) {
        this.showToast('Failed to create folder: ' + error.message, 'error');
      } finally {
        this.loading = false;
      }
    },

    async uploadFile() {
      const fileInput = this.$refs.fileInput || this.$refs.mobileFileInput;
      if (!fileInput.files.length) return;
      
      this.loading = true;
      try {
        const file = fileInput.files[0];
        const formData = new FormData();
        formData.append('file', file);
        
        const uploadPath = this.currentPath || '';
        
        const response = await fetch(`http://127.0.0.1:9876/bucket/file/${uploadPath}`, {
          method: 'POST',
          body: formData
        });
        
        if (!response.ok) throw new Error('Failed to upload file');
        
        const data = await response.json();
        this.showToast(data.message || 'File uploaded successfully', 'success');
        fileInput.value = '';
        await this.loadFolder();
      } catch (error) {
        this.showToast('Failed to upload file: ' + error.message, 'error');
      } finally {
        this.loading = false;
      }
    },

    handleItemClick(item) {
      if (item.type === 'folder') {
        this.navigateToFolder(item.name);
      }
    },

    navigateToFolder(folderName) {
      if (folderName === 'base') {
        this.currentPath = '';
        this.currentFolder = 'base';
      } else {
        if (this.currentPath) {
          this.currentPath = `${this.currentPath}/${folderName}`;
        } else {
          this.currentPath = folderName;
        }
        this.currentFolder = this.currentPath;
      }
      this.loadFolder();
    },

    goBack() {
      const segments = this.currentPath.split('/').filter(s => s);
      if (segments.length <= 1) {
        this.currentPath = '';
        this.currentFolder = 'base';
      } else {
        segments.pop();
        this.currentPath = segments.join('/');
        this.currentFolder = this.currentPath;
      }
      this.loadFolder();
    },

    getBreadcrumbPath(index) {
      return this.breadcrumbs.slice(0, index + 1).join('/');
    },

    async downloadFile(filename) {
      const path = this.currentPath ? `${this.currentPath}/${filename}` : filename;
      const url = `/bucket/file/${path}`;
      window.open(url, '_blank');
    },

    async deleteFile(filename) {
      const path = this.currentPath ? `${this.currentPath}/${filename}` : filename;
      const url = `http://127.0.0.1:9876/bucket/file/${path}`;
      try {
        const response = await fetch(url, {method:'delete'});
        if (!response.ok) throw new Error('Failed to delete files');
        const data = await response.json();
        this.showToast('File deleted Successfully!');
        this.refreshFiles()
      } catch (error) {
        this.showToast('Failed to delete files: ' + error.message, 'error');
      } finally {
        this.loading = false;
      }
    },

    viewFile(filename) {
      const path = this.currentPath ? `${this.currentPath}/${filename}` : filename;
      const url = `/bucket/file/${path}?view=true`;
      window.open(url, '_blank');
    },

    showToast(message, type) {
      this.toasts.push({ message, type });
      setTimeout(() => {
        this.toasts.shift();
      }, 3000);
    },

    removeToast(index) {
      this.toasts.splice(index, 1);
    },

    getItemIcon(item) {
      if (item.type === 'folder') {
        return 'bi bi-folder';
      } else {
        const ext = item.name.split('.').pop().toLowerCase();
        switch (ext) {
          case 'jpg':
          case 'jpeg':
          case 'png':
          case 'gif':
            return 'bi bi-file-image';
          case 'pdf':
            return 'bi bi-file-pdf';
          case 'txt':
            return 'bi bi-file-text';
          case 'zip':
          case 'rar':
            return 'bi bi-file-zip';
          default:
            return 'bi bi-file-earmark';
        }
      }
    },

    getItemIconColor(item) {
      if (item.type === 'folder') {
        return 'text-warning';
      } else {
        const ext = item.name.split('.').pop().toLowerCase();
        switch (ext) {
          case 'jpg':
          case 'jpeg':
          case 'png':
          case 'gif':
            return 'text-success';
          case 'pdf':
            return 'text-danger';
          case 'txt':
            return 'text-info';
          case 'zip':
          case 'rar':
            return 'text-primary';
          default:
            return 'text-muted';
        }
      }
    }
  }
}).mount('#app');
</script>
</body>
</html>
